(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{14904:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/portfolio",function(){return r(81374)}])},47297:function(e,t,r){"use strict";var n=r(85893);r(67294);var a=r(33096),s=r(58091),i=r(46986),o=r(46558);let l=e=>{let{items:t,children:r}=e,{account:l}=(0,o.Z)();return(0,n.jsx)(a.Z,{display:"flex",flexDirection:"column",gap:"1rem",children:(0,n.jsx)(a.Z,{display:"flex",bgColor:"#181915",width:{base:"100%",lg:"min"},height:"100%",maxHeight:{base:"150px"},marginInline:"auto",borderRadius:{base:"12px",lg:"31px"},flexDirection:{base:"column",lg:"row"},alignItems:{base:"flex-start",lg:"center"},justifyContent:"space-between",padding:{base:"1.2rem 1.2rem",lg:"1.2rem 2rem"},sx:{"& > *":{whiteSpace:"nowrap"}},gap:{base:"0.5rem",lg:"5rem"},children:t&&t.map((e,t)=>{let{loading:r,data:o,customColor:d}=e.value;return(0,n.jsxs)(a.Z,{display:"inline-flex",alignItems:"center",gap:"0.5rem",children:[(0,n.jsxs)(s.Z,{variant:"banner-sub-label",children:[e.label,":"]}),r?(0,n.jsx)(i.Z,{width:"50px"}):(0,n.jsx)(s.Z,{variant:"banner-sub-desc",color:null!=d?d:void 0,children:o&&l?o:"--"})]},"".concat(t,"-").concat(e.label))})})})};t.Z=l},57919:function(e,t,r){"use strict";r.d(t,{Bb:function(){return d},Fq:function(){return o},KX:function(){return s},fu:function(){return l},mW:function(){return i},pK:function(){return u},wG:function(){return c}}),r(23732);var n=r(34332),a=r(88767);let s=()=>{let{stats:e}=(0,n.Z)();return(0,a.useQuery)(["global-query"],()=>{if(!e.isSuccess)throw Error("Initializing global stats error");return e.data.global},{enabled:Boolean(void 0!==e.data)})},i=e=>{let{stats:t}=(0,n.Z)();return(0,a.useQuery)(["tokenStats",e],()=>{if(!t.isSuccess)throw Error("No stats");if(""===e)throw Error("No token");let r=t.data.assets[e];if(!r)throw Error("tokenStats not found for ".concat(e));return r},{enabled:Boolean(t.isSuccess&&""!==e)})},o=e=>{let{stats:t}=(0,n.Z)();return(0,a.useQuery)(["price-stats",JSON.stringify(t)],async()=>{if(!t.isSuccess)throw Error("No stats");if(!e)throw Error("No asset name");return t.data.assets[e].price},{enabled:Boolean(t.isSuccess&&void 0!==e)})},l=()=>{let{config:e,stats:t}=(0,n.Z)(),r=null==e?void 0:e.getAssets();return(0,a.useQuery)(["multi-price-stats",JSON.stringify(r),JSON.stringify(t.data)],async()=>{if(!r)throw Error("No config found");if(!t.isSuccess)throw Error("No stats found");let e={};for(let[n,a]of Object.entries(t.data.assets)){var s;e={...e,[null==r?void 0:null===(s=r[n])||void 0===s?void 0:s.address]:a.price}}return e},{enabled:Boolean(r&&t.isSuccess),staleTime:12e4,refetchOnWindowFocus:!1,refetchOnMount:!1})},d=()=>{let{stats:e}=(0,n.Z)();return(0,a.useQuery)(["collaterals-stats"],()=>{if(!e.isSuccess)throw Error("Initializing collateral stats error");let t={},{assets:r}=e.data;return Object.entries(r).forEach(e=>{let[r,n]=e,{collateral:a,price:s,assetConfig:i}=n;"collateral"in n&&(t={...t,[r]:{collateral:a,price:s,assetConfig:i}})}),t},{enabled:Boolean(void 0!==e.data)})},c=()=>{let{stats:e}=(0,n.Z)();return(0,a.useQuery)(["reserves-stats"],()=>{if(!e.isSuccess)throw Error("Initializing reserves stats error");let t={},{assets:r}=e.data;return Object.entries(r).forEach(e=>{let[r,n]=e,{reserve:a,price:s,assetConfig:i}=n;"reserve"in n&&(t={...t,[r]:{reserve:a,price:s,assetConfig:i}})}),t},{enabled:Boolean(void 0!==e.data)})},u=e=>{let{stats:t}=(0,n.Z)();return(0,a.useQuery)(["collateral-rewards-stats",e],async()=>{var r,n,a,s,i;if(!t.isSuccess)throw Error("collateral rewards ".concat(e," stats issue: main stats error"));let{assets:o}=t.data;return null!==(i=null!==(s=null===(r=o[e].collateral.AAVE)||void 0===r?void 0:r.rewards)&&void 0!==s?s:null===(n=o[e].collateral.Convex)||void 0===n?void 0:n.rewards)&&void 0!==i?i:null===(a=o[e].collateral.Stargate)||void 0===a?void 0:a.rewards},{enabled:Boolean(void 0!==t.data&&t.isSuccess)})}},81374:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return ev}});var n,a,s,i,o,l,d=r(85893),c=r(67294),u=r(11163),h=r(33096),m=r(9008),f=r.n(m),x=r(93330),p=r(47297),g=r(46558),v=r(23732),b=r(66260),y=r(76585),j=r(88767),w=r(56371),A=r(66319),S=r(3588),Z=r(43382),T=r(34332),I=r(57919);(n=i||(i={}))[n.asset=0]="asset",n[n.amount=1]="amount",n[n.averagePrice=2]="averagePrice",n[n.price=3]="price",n[n.presentValue=4]="presentValue",(a=o||(o={}))[a.timestamp=0]="timestamp",a[a.longAsset=1]="longAsset",a[a.longAmount=2]="longAmount",a[a.longPrice=3]="longPrice",a[a.shortAsset=4]="shortAsset",a[a.shortAmount=5]="shortAmount",a[a.shortPrice=6]="shortPrice",a[a.tradeValue=7]="tradeValue",(s=l||(l={}))[s.timestamp=0]="timestamp",s[s.asset=1]="asset",s[s.amount=2]="amount",s[s.value=3]="value",s[s.action=4]="action",s[s.txId=5]="txId";var N=r(58091),C=r(65982),E=r(92849),F=r(28387),P=r(54520),q=r(18702),_=r(59430),O=r(44040),k=r(98053),L=r(34031),B=r(76734),D=r(82359),V=(...e)=>e.filter(Boolean).join(" ");function $(...e){return function(t){e.some(e=>(null==e||e(t),null==t?void 0:t.defaultPrevented))}}var[R,J,Q,W]=(0,_.n)(),[z,M]=(0,F.k)({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"}),[U,G]=(0,F.k)({});function H(e,t){return`${e}--tab-${t}`}function X(e,t){return`${e}--tabpanel-${t}`}var[K,Y]=(0,F.k)({name:"TabsStylesContext",errorMessage:"useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<Tabs />\" "}),ee=(0,E.Gp)(function(e,t){let r=(0,E.jC)("Tabs",e),{children:n,className:a,...s}=(0,P.Lr)(e),{htmlProps:i,descendants:o,...l}=function(e){let{defaultIndex:t,onChange:r,index:n,isManual:a,isLazy:s,lazyBehavior:i="unmount",orientation:o="horizontal",direction:l="ltr",...d}=e,[u,h]=(0,c.useState)(t??0),[m,f]=(0,k.T)({defaultValue:t??0,value:n,onChange:r});(0,c.useEffect)(()=>{null!=n&&h(n)},[n]);let x=Q(),p=(0,c.useId)(),g=e.id??p,v=`tabs-${g}`;return{id:v,selectedIndex:m,focusedIndex:u,setSelectedIndex:f,setFocusedIndex:h,isManual:a,isLazy:s,lazyBehavior:i,orientation:o,descendants:x,direction:l,htmlProps:d}}(s),d=(0,c.useMemo)(()=>l,[l]),{isFitted:u,...h}=i;return c.createElement(R,{value:o},c.createElement(z,{value:d},c.createElement(K,{value:r},c.createElement(E.m$.div,{className:V("chakra-tabs",a),ref:t,...h,__css:r.root},n))))});ee.displayName="Tabs",(0,E.Gp)(function(e,t){let r=function(){let e=M(),t=J(),{selectedIndex:r,orientation:n}=e,a="horizontal"===n,s="vertical"===n,[i,o]=(0,c.useState)(()=>a?{left:0,width:0}:s?{top:0,height:0}:void 0),[l,d]=(0,c.useState)(!1);return(0,O.G)(()=>{if(null==r)return;let e=t.item(r);if(null==e)return;a&&o({left:e.node.offsetLeft,width:e.node.offsetWidth}),s&&o({top:e.node.offsetTop,height:e.node.offsetHeight});let n=requestAnimationFrame(()=>{d(!0)});return()=>{n&&cancelAnimationFrame(n)}},[r,a,s,t]),{position:"absolute",transitionProperty:"left, right, top, bottom, height, width",transitionDuration:l?"200ms":"0ms",transitionTimingFunction:"cubic-bezier(0, 0, 0.2, 1)",...i}}(),n={...e.style,...r},a=Y();return c.createElement(E.m$.div,{ref:t,...e,className:V("chakra-tabs__tab-indicator",e.className),style:n,__css:a.indicator})}).displayName="TabIndicator";var et=(0,E.Gp)(function(e,t){let r=function(e){let{focusedIndex:t,orientation:r,direction:n}=M(),a=J(),s=(0,c.useCallback)(e=>{let s=()=>{var e;let r=a.nextEnabled(t);r&&(null==(e=r.node)||e.focus())},i=()=>{var e;let r=a.prevEnabled(t);r&&(null==(e=r.node)||e.focus())},o=()=>{var e;let t=a.firstEnabled();t&&(null==(e=t.node)||e.focus())},l=()=>{var e;let t=a.lastEnabled();t&&(null==(e=t.node)||e.focus())},d="horizontal"===r,c="vertical"===r,u=e.key,h={["ltr"===n?"ArrowLeft":"ArrowRight"]:()=>d&&i(),["ltr"===n?"ArrowRight":"ArrowLeft"]:()=>d&&s(),ArrowDown:()=>c&&s(),ArrowUp:()=>c&&i(),Home:o,End:l}[u];h&&(e.preventDefault(),h(e))},[a,t,r,n]);return{...e,role:"tablist","aria-orientation":r,onKeyDown:$(e.onKeyDown,s)}}({...e,ref:t}),n=Y(),a={display:"flex",...n.tablist};return c.createElement(E.m$.div,{...r,className:V("chakra-tabs__tablist",e.className),__css:a})});et.displayName="TabList";var er=(0,E.Gp)(function(e,t){let r=function(e){let{children:t,...r}=e,{isLazy:n,lazyBehavior:a}=M(),{isSelected:s,id:i,tabId:o}=G(),l=(0,c.useRef)(!1);s&&(l.current=!0);let d=(0,D.k)({wasSelected:l.current,isSelected:s,enabled:n,mode:a});return{tabIndex:0,...r,children:d?t:null,role:"tabpanel","aria-labelledby":o,hidden:!s,id:i}}({...e,ref:t}),n=Y();return c.createElement(E.m$.div,{outline:"0",...r,className:V("chakra-tabs__tab-panel",e.className),__css:n.tabpanel})});er.displayName="TabPanel";var en=(0,E.Gp)(function(e,t){let r=function(e){let t=M(),{id:r,selectedIndex:n}=t,a=(0,L.W)(e.children),s=a.map((e,t)=>(0,c.createElement)(U,{key:t,value:{isSelected:t===n,id:X(r,t),tabId:H(r,t),selectedIndex:n}},e));return{...e,children:s}}(e),n=Y();return c.createElement(E.m$.div,{...r,width:"100%",ref:t,className:V("chakra-tabs__tab-panels",e.className),__css:n.tabpanels})});en.displayName="TabPanels";var ea=(0,E.Gp)(function(e,t){let r=Y(),n=function(e){let{isDisabled:t,isFocusable:r,...n}=e,{setSelectedIndex:a,isManual:s,id:i,setFocusedIndex:o,selectedIndex:l}=M(),{index:d,register:c}=W({disabled:t&&!r}),u=d===l,h=()=>{a(d)},m=()=>{o(d),s||t&&r||a(d)},f=(0,q.h)({...n,ref:(0,B.lq)(c,e.ref),isDisabled:t,isFocusable:r,onClick:$(e.onClick,h)});return{...f,id:H(i,d),role:"tab",tabIndex:u?0:-1,type:"button","aria-selected":u,"aria-controls":X(i,d),onFocus:t?void 0:$(e.onFocus,m)}}({...e,ref:t}),a={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...r.tab};return c.createElement(E.m$.button,{...n,className:V("chakra-tabs__tab",e.className),__css:a})});ea.displayName="Tab";var es=r(36696),ei=r(47741),eo=r(53818);let el=e=>{let{tabItems:t,children:r,...n}=e;return(0,d.jsx)(h.Z,{w:"100%",maxW:"100vw",...n,children:(0,d.jsxs)(ee,{variant:"unstyled",isFitted:!0,children:[(0,d.jsx)(et,{children:t.map((e,t)=>(0,d.jsx)(ea,{as:ei.zx,variant:"tab-group-item",fontSize:{base:"12px",sm:"14px"},textTransform:"uppercase",letterSpacing:"0.45px",whiteSpace:"normal",fontWeight:"light",borderRadius:"10px 10px 0 0",_selected:{bg:"lever.bg.gradient",color:"lever.main"},children:e},"".concat(e,"-index")))}),(0,d.jsx)(en,{sx:{"& > div":{padding:0}},children:r})]})})};var ed=r(39239),ec=r(55678),eu=r(49310),eh={src:"/_next/static/media/icon_copy_transparent_bg.c68d4452.svg",height:19,width:19},em=r(8680),ef=r(74158);let ex=["Open Positions","Trade History","Withdrawals & Repayments"],ep=e=>{let{account:t}=(0,g.Z)(),{push:r}=(0,u.useRouter)(),{openPositions:n,tradeHistory:a,withdrawalsAndRepayment:s}=e,[i,o]=c.useState(0),[l,m]=c.useState(!1);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(h.Z,{display:"grid",gridAutoFlow:"row",padding:"1rem",sx:{"@media screen and (max-width: 678px)":{display:"none"}},children:[(0,d.jsx)(eo.Z,{title:"Open Positions",query:n.query,setSortStatus:n.sortArray,placeholderCustom:"No open positions. Please go to the Trade page to open a position.",headItems:[{name:"Asset"},{name:"Amount",alignment:!0},{name:"Average Price",alignment:!0},{name:"Current Price",alignment:!0},{name:"Asset Value",alignment:!0}],rows:n.query.isSuccess?n.query.data.map((e,t)=>({id:"".concat(t,"-").concat(e.asset),items:[{isMainColumn:!0,loading:Boolean(!e.asset),data:e.asset},{loading:Boolean(!e.amount),data:(0,b.dz)(Number(e.amount)),error:!e.amount,isNumeric:!0},{loading:Boolean(!e.averagePrice),data:e.averagePrice?"$".concat((0,w.commify)(isNaN(parseInt(e.averagePrice))?0:Math.abs(parseInt(e.averagePrice)))):"--",isNumeric:!0},{loading:Boolean(!e.price),data:"$".concat((0,w.commify)(parseFloat(e.price).toFixed(0))),error:!e.price,isNumeric:!0},{loading:Boolean(!e.presentValue),data:"".concat((0,b.ld)(e.presentValue)),error:!e.presentValue,isNumeric:!0}],pushRouter(){r({pathname:0>parseFloat(null==e?void 0:e.amount)?"/portfolio/repay":"/portfolio/withdraw",query:{[0>parseFloat(null==e?void 0:e.amount)?"from":"to"]:"wallet",assetName:null==e?void 0:e.asset}})}})):void 0}),(0,d.jsx)(eo.Z,{title:"Trade History",query:a.query,queryLength:a.query.isSuccess?a.query.data.length:void 0,pagination:!0,setSortStatus:a.sortArray,showLiquidationHistory:!0,rowSelector:!0,placeholderCustom:"There are no transactions yet",headItems:[{name:"Date/Time"},{name:"Long",alignment:"centered"},{name:"Long Amount",alignment:!0},{name:"Entry Price",alignment:!0},{name:"Short",alignment:"centered"},{name:"Short Amount",alignment:!0},{name:"Entry Price",alignment:!0},{name:"Trade Value",alignment:!0}],rows:a.query.isSuccess?a.query.data.map((e,t)=>({id:"tradehistory-".concat(t),items:[{loading:Boolean(!e.timestamp),data:e.timestamp.toString(),error:void 0===e.timestamp||null===e.timestamp,isDateColumn:!0},{loading:Boolean(!e.longAsset),data:e.longAsset,error:void 0===e.longAsset||null===e.longAsset,isNumeric:"centered",isMainColumn:!0},{loading:Boolean(!e.longAmount&&a.query.isLoading),data:(0,b.RR)(e.longAmount),error:void 0===e.longAmount||null===e.longAmount,isNumeric:!0},{loading:Boolean(!e.longPrice&&a.query.isLoading),data:"$".concat((0,w.commify)(e.longPrice)),error:void 0===e.longPrice||null===e.longPrice,isNumeric:!0},{loading:Boolean(!e.shortAsset),data:e.shortAsset,error:void 0===e.shortAsset||null===e.shortAsset,isNumeric:"centered",isMainColumn:!0},{loading:Boolean(!e.shortAmount&&a.query.isLoading),data:(0,b.RR)(e.shortAmount),error:void 0===e.shortAmount||null===e.shortAmount,isNumeric:!0},{loading:Boolean(!e.shortPrice&&a.query.isLoading),data:(0,w.commify)(e.shortPrice),error:void 0===e.shortPrice||null===e.shortPrice,isNumeric:!0},{loading:Boolean(!e.tradeValue&&a.query.isLoading),data:e.tradeValue,error:void 0===e.tradeValue||null===e.tradeValue,isNumeric:!0}],pushRouter(){}})):void 0}),(0,d.jsx)(eo.Z,{title:"Withdrawal and Repayments",query:s.query,queryLength:s.query.isSuccess?s.query.data.length:void 0,pagination:!0,rowSelector:!0,setSortStatus:s.sortArray,headItems:[{name:"Date/Time"},{name:"Asset"},{name:"Amount",alignment:!0},{name:"Value",alignment:!0},{name:"Action",alignment:"centered"},{name:"Transaction ID"}],rows:s.query.isSuccess?s.query.data.map((e,t)=>({id:"withdraw-and-repay-".concat(t),pushRouter(){},items:[{loading:!e.timestamp,data:e.timestamp,error:void 0===e.timestamp,isDateColumn:!0},{loading:!e.asset,data:e.asset,error:void 0===e.asset,isMainColumn:!0},{loading:!e.amount,data:e.amount,error:void 0===e.amount,isNumeric:!0},{loading:!e.value,data:"$".concat(parseInt(e.value)),error:void 0===e.value,isNumeric:!0},{loading:!e.action,data:e.action,error:void 0===e.action,isNumeric:"centered"},{loading:!e.txId,data:(0,b.Xn)(e.txId,6,6),error:void 0===e.txId,copyFn(){navigator.clipboard.writeText(e.txId).then(()=>{(0,ec.Am)((0,d.jsx)(eu.$,{status:"success",description:"Copied to clipboard"}))})}}]})):void 0})]}),(0,d.jsx)(h.Z,{width:"100%",maxW:"100vw",sx:{"@media screen and (min-width: 678px)":{display:"none"}},children:(0,d.jsxs)(el,{tabItems:ex,children:[(0,d.jsx)(er,{children:(0,d.jsx)(es.xJ,{width:"100%",whiteSpace:"normal",children:(0,d.jsxs)(es.iA,{variant:"unstyled",sx:{"& > thead > tr":{h:"65px"},"& > thead > tr > th > div":{display:"flex",alignItems:"center"},"Tbody > Tr:nth-of-type(odd)":{bgColor:"leverScheme.200"},"Tbody > Tr:nth-of-type(even)":{bgColor:"leverScheme.100"},"Tbody > Tr > Td > div":{display:"flex",flexDirection:"column",justifyContent:"center",gap:"0.2rem"}},children:[(0,d.jsx)(es.hr,{bg:"#2C2E31",children:(0,d.jsxs)(es.Tr,{children:[(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Asset"})})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Amount"})})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Current Price"})})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Present Value"})})})]})}),(0,d.jsx)(es.p3,{children:n.query.isSuccess?n.query.data.map((e,t)=>(0,d.jsxs)(es.Tr,{onClick(){r({pathname:0>parseFloat(null==e?void 0:e.amount)?"/portfolio/repay":"/portfolio/withdraw",query:{[0>parseFloat(null==e?void 0:e.amount)?"from":"to"]:"wallet",assetName:null==e?void 0:e.asset}})},children:[(0,d.jsx)(es.Td,{children:(0,d.jsx)(h.Z,{width:"100%",alignItems:"flex-start",children:(0,d.jsx)(ed.Z,{tokenDefault:e.asset})})}),(0,d.jsx)(es.Td,{children:(0,d.jsx)(h.Z,{width:"100%",alignItems:"flex-end",children:(0,d.jsx)(N.Z,{variant:"table-sub",children:(0,b.dz)(Number(e.amount))})})}),(0,d.jsx)(es.Td,{children:(0,d.jsx)(h.Z,{width:"100%",alignItems:"flex-end",children:(0,d.jsx)(N.Z,{variant:"table-sub",children:"$".concat((0,w.commify)(parseFloat(e.price).toFixed(0)))})})}),(0,d.jsx)(es.Td,{children:(0,d.jsx)(h.Z,{width:"100%",alignItems:"flex-end",children:(0,d.jsx)(N.Z,{variant:"table-sub",children:"".concat((0,b.ld)(e.presentValue))})})})]},"".concat(t,"-").concat(JSON.stringify(e)))):void 0})]})})}),(0,d.jsxs)(er,{children:[(0,d.jsx)(es.xJ,{width:"100%",whiteSpace:"normal",children:(0,d.jsxs)(es.iA,{variant:"unstyled",sx:{"& > thead > tr":{h:"65px"},"& > thead > tr > th > div":{display:"flex",flexDirection:"column",justifyContent:"center"},"Tbody > Tr:nth-of-type(odd)":{bgColor:"leverScheme.200"},"Tbody > Tr:nth-of-type(even)":{bgColor:"leverScheme.100"},"Tbody > Tr > Td > div":{display:"flex",flexDirection:"column",justifyContent:"center",gap:"0.2rem"}},children:[(0,d.jsx)(es.hr,{bg:"#2C2E31",children:(0,d.jsxs)(es.Tr,{children:[(0,d.jsx)(es.Th,{children:(0,d.jsxs)(h.Z,{children:[(0,d.jsx)(N.Z,{variant:"table-heading",children:"Long"}),(0,d.jsx)(N.Z,{variant:"table-heading",children:"Short"})]})}),(0,d.jsx)(es.Th,{children:(0,d.jsxs)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:[(0,d.jsx)(N.Z,{variant:"table-heading",children:"Long Amt."}),(0,d.jsx)(N.Z,{variant:"table-heading",children:"Short Amt."})]})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Entry Price"})})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Trade Value"})})})]})}),(0,d.jsx)(es.p3,{children:a.query.isSuccess?a.query.data.map((e,t)=>(0,d.jsxs)(es.Tr,{children:[(0,d.jsx)(es.Td,{children:(0,d.jsxs)(h.Z,{width:"100%",alignItems:"flex-start",children:[(0,d.jsx)(N.Z,{variant:"table-sub",color:"lever.sub",children:new Date(1e3*e.timestamp).toLocaleDateString()}),(0,d.jsx)(ed.Z,{tokenDefault:e.longAsset}),(0,d.jsx)(ed.Z,{tokenDefault:e.shortAsset})]})}),(0,d.jsx)(es.Td,{children:(0,d.jsxs)(h.Z,{width:"100%",alignItems:"flex-end",justifyContent:"flex-end",children:[(0,d.jsx)(N.Z,{variant:"table-sub",children:(0,b.RR)(e.longAmount)}),(0,d.jsx)(N.Z,{variant:"table-sub",children:(0,b.RR)(e.shortAmount)})]})}),(0,d.jsx)(es.Td,{children:(0,d.jsxs)(h.Z,{width:"100%",alignItems:"flex-end",children:[(0,d.jsx)(N.Z,{variant:"table-sub",children:" "}),(0,d.jsx)(N.Z,{variant:"table-sub",children:"$".concat(e.longPrice)}),(0,d.jsx)(N.Z,{variant:"table-sub",children:"$".concat(e.shortPrice)})]})}),(0,d.jsx)(es.Td,{children:(0,d.jsx)(h.Z,{width:"100%",alignItems:"flex-end",children:(0,d.jsxs)(N.Z,{variant:"table-sub",children:["$",e.tradeValue]})})})]},"".concat(t,"-").concat(JSON.stringify(e)))):void 0})]})}),(0,d.jsx)(h.Z,{display:"flex",justifyContent:"flex-end",alignItems:"center",my:"1rem",children:(0,d.jsx)(ei.zx,{variant:"unstyled",onClick:()=>m(!0),children:(0,d.jsx)(C.Z,{src:em.Z,alt:"liquidation-icon-mobile"})})})]}),(0,d.jsx)(er,{children:(0,d.jsx)(es.xJ,{width:"100%",whiteSpace:"normal",children:(0,d.jsxs)(es.iA,{variant:"unstyled",sx:{"& > thead > tr":{h:"65px"},"& > thead > tr > th > div":{display:"flex",flexDirection:"column",justifyContent:"center"},"Tbody > Tr:nth-of-type(odd)":{bgColor:"leverScheme.200"},"Tbody > Tr:nth-of-type(even)":{bgColor:"leverScheme.100"},"Tbody > Tr > Td > div":{display:"flex",flexDirection:"column",justifyContent:"center",gap:"0.2rem"}},children:[(0,d.jsx)(es.hr,{bg:"#2C2E31",children:(0,d.jsxs)(es.Tr,{children:[(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Asset"})})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Amount"})})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Value"})})}),(0,d.jsx)(es.Th,{children:(0,d.jsx)(h.Z,{justifyContent:"flex-end",textAlign:"end",children:(0,d.jsx)(N.Z,{variant:"table-heading",children:"Action"})})})]})}),(0,d.jsx)(es.p3,{children:s.query.isSuccess?s.query.data.map((e,t)=>(0,d.jsxs)(es.Tr,{children:[(0,d.jsx)(es.Td,{children:(0,d.jsxs)(h.Z,{width:"100%",alignItems:"flex-start",children:[(0,d.jsx)(N.Z,{variant:"table-sub",color:"lever.sub",children:new Date(1e3*parseFloat(e.timestamp)).toLocaleDateString()}),(0,d.jsx)(ed.Z,{tokenDefault:e.asset})]})}),(0,d.jsx)(es.Td,{children:(0,d.jsx)(h.Z,{width:"100%",alignItems:"flex-end",justifyContent:"flex-end",children:(0,d.jsx)(N.Z,{variant:"table-sub",children:e.amount})})}),(0,d.jsx)(es.Td,{children:(0,d.jsxs)(h.Z,{width:"100%",alignItems:"flex-end",children:[(0,d.jsx)(N.Z,{variant:"table-sub",children:" "}),(0,d.jsx)(N.Z,{variant:"table-sub",children:"$".concat(parseInt(e.value))})]})}),(0,d.jsx)(es.Td,{children:(0,d.jsxs)(h.Z,{width:"100%",alignItems:"flex-end",children:[(0,d.jsxs)(h.Z,{display:"flex",gap:"0.2rem",alignItems:"center",children:[(0,d.jsx)(N.Z,{variant:"table-sub",color:"lever.sub",children:(0,b.Xn)(e.txId,7)}),(0,d.jsx)(C.Z,{src:eh,alt:"transparent-copy-mobile-icon",width:5,height:5,onClick(){navigator.clipboard.writeText(e.txId).then(()=>{(0,ec.Am)((0,d.jsx)(eu.$,{status:"success",description:"Copied to clipboard"}))})}})]}),(0,d.jsx)(N.Z,{variant:"table-sub",children:e.action})]})})]},"".concat(t,"-").concat(JSON.stringify(e)))):void 0})]})})})]})}),(0,d.jsx)(ef.Z,{isOpen:l,setOpen:m})]})},eg=()=>{let[e,t]=c.useState([]),[r,n]=c.useState([]),[a,s]=c.useState([]),m=(0,j.useQueryClient)(),{leverageUsed:N,liquidationThreshold:C}=(0,Z.Z)(),{push:E}=(0,u.useRouter)(),{account:F,impersonatedAccount:P}=(0,g.Z)(),q=(0,S.Z)(),_=(0,v.P8)(),{config:O}=(0,T.Z)(),k=(0,I.fu)(),L=(0,v.i1)(),B=(0,y.Z)(),D=(0,A.cA)(),V=(0,j.useQuery)(["trade-history",F,r,JSON.stringify(L)],async()=>{if(!L.isSuccess)throw Error("liquidation-history: subgraphDataQuery is not successful yet");let{tradeLogs:e}=L.data,t=[];for(let n of e){let a=null==O?void 0:O.getAsset(n.shortAsset),s=null==O?void 0:O.getAsset(n.longAsset);if(!a)throw Error("Config for ".concat(n.shortAsset," not found"));if(!s)throw Error("Config for ".concat(n.longAsset," not found"));t.push({timestamp:parseFloat(n.timestamp),longAsset:s.symbol,longAmount:(0,w.formatUnits)(n.boughtAmount,s.decimals),longPrice:parseFloat((0,w.formatUnits)(n.longAssetPrice,8)).toFixed(0),shortAsset:a.symbol,shortAmount:(0,w.formatUnits)(n.soldAmount,a.decimals),shortPrice:parseFloat((0,w.formatUnits)(n.shortAssetPrice,8)).toFixed(0),tradeValue:(0,w.commify)((parseFloat((0,w.formatUnits)(n.soldAmount,a.decimals))*parseFloat((0,w.formatUnits)(n.shortAssetPrice,8))).toFixed(0))})}return t.sort((e,t)=>t.timestamp-e.timestamp).sort((e,t)=>{let n=o[r.findIndex(e=>e>0)];return["longAsset","shortAsset","timestamp"].includes(n)?1===r[r.findIndex(e=>e>0)]?e[n]>t[n]?1:-1:2===r[r.findIndex(e=>e>0)]?e[n]>t[n]?-1:1:0:1===r[r.findIndex(e=>e>0)]?parseFloat(e[n])>parseFloat(t[n])?-1:1:2===r[r.findIndex(e=>e>0)]?parseFloat(e[n])>parseFloat(t[n])?1:-1:0})},{enabled:Boolean(F&&L.isSuccess),staleTime:12e4,refetchOnWindowFocus:!1,notifyOnChangeProps:["data"],keepPreviousData:!0}),$=(0,j.useQuery)(["withdrawal-repayment-history",F,a],async()=>{if(!O)throw Error("withdrawal-repayment error: config not found");if(!F)throw Error("withdrawal-repayment error: user not found");if(!L.isSuccess)throw Error("withdrawal-repayment error: subgraph not found");let{withdrawnLongLogs:e,repaidShortLogs:t}=L.data,r=O.getAssets(),n=[],s=e=>{var t,n;return null===(t=Object.entries(r).find(t=>{let[r,n]=t;return n.address.toLowerCase()===e.toLowerCase()}))||void 0===t?void 0:null===(n=t[1])||void 0===n?void 0:n.decimals};for(let i of e)n.push({txId:i.id,timestamp:i.timestamp,asset:i.asset,amount:(0,w.formatUnits)(i.amount,s(i.asset)),value:i.value,action:"Withdrawn"});for(let o of t)n.push({txId:o.id,timestamp:o.timestamp,asset:o.asset,amount:(0,w.formatUnits)(o.amount,s(o.asset)),value:o.value,action:"Repaid"});return n.sort((e,t)=>parseInt(t.timestamp)-parseInt(e.timestamp)).sort((e,t)=>{let r=l[a.findIndex(e=>e>0)];return"asset"==r||"action"==r?1===a[a.findIndex(e=>e>0)]?e[r]>t[r]?1:-1:2===a[a.findIndex(e=>e>0)]?e[r]>t[r]?-1:1:0:1===a[a.findIndex(e=>e>0)]?parseFloat(e[r])>parseFloat(t[r])?-1:1:2===a[a.findIndex(e=>e>0)]?parseFloat(e[r])>parseFloat(t[r])?1:-1:0})},{enabled:Boolean(F&&L.isSuccess&&O),refetchOnWindowFocus:!1,keepPreviousData:!0,notifyOnChangeProps:["data"]}),R=(0,j.useQuery)(["open-positions",F,e,JSON.stringify(D.data),JSON.stringify(_.data),JSON.stringify(V)],async()=>{if(!F)throw Error("Open position error: No logged in user");if(!_.isSuccess)throw Error("Open position error: No reserve config");if(!D.isSuccess)throw Error("Open position error: userAssetInfo failed to query");if(!k.isSuccess)throw Error("Open position error: prices failed to query");if(!V.isSuccess)throw Error("Open position error: trade history failed to query");if(!L.isSuccess)throw Error("Open position error: subgraph failed to query");let t=0,r=[];if(L.data.foreclosedLogs.length>0)for(let{timestamp:n,...a}of L.data.foreclosedLogs)Number(n)>t&&(t=Number(n));for(let[s,o]of Object.entries(D.data)){var l,d,c;let u=null===(l=Object.entries(_.data).find(e=>{let[,t]=e;return s===t.address}))||void 0===l?void 0:l[1],h=0,m=0;V.data.map(e=>{e.timestamp>t&&(e.longAsset==(null==u?void 0:u.symbol)?(m+=parseFloat(e.longPrice),h++):e.shortAsset==(null==u?void 0:u.symbol)&&(m+=parseFloat(e.shortPrice),h++))}),o.position.eq(0)||r.push({asset:null===(d=Object.entries(_.data).find(e=>{let[,t]=e;return s===t.address}))||void 0===d?void 0:d[0],amount:Number((0,w.formatUnits)(o.position,null==u?void 0:u.decimals)).toString(),averagePrice:null!==(c=String(m/h))&&void 0!==c?c:void 0,price:k.data[s].toString(),presentValue:(parseFloat((0,w.formatUnits)(o.position,null==u?void 0:u.decimals))*k.data[s]).toString()})}return r.sort((t,r)=>{let n=i[e.findIndex(e=>e>0)];return"asset"==n?1===e[e.findIndex(e=>e>0)]?t[n]>r[n]?1:-1:2===e[e.findIndex(e=>e>0)]?t[n]>r[n]?-1:1:0:1===e[e.findIndex(e=>e>0)]?parseFloat(t[n])>parseFloat(r[n])?-1:1:2===e[e.findIndex(e=>e>0)]?parseFloat(t[n])>parseFloat(r[n])?1:-1:0})},{enabled:Boolean(_.isSuccess&&D.isSuccess&&k.isSuccess&&V.isSuccess&&F&&L.isSuccess),staleTime:12e4,refetchOnWindowFocus:!1,refetchOnMount:!1}),[J,Q]=c.useState(5);return c.useEffect(()=>{(async function(){await m.invalidateQueries("open-positions")})().then()},[F,P]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(f(),{children:[(0,d.jsx)("title",{children:"Portfolio | LeverFi"}),(0,d.jsx)("meta",{name:"description",content:"Margin Trade with 10x Leverage using Yield Bearing Assets"}),(0,d.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,d.jsx)(x.Z,{pageTitle:"Portfolio",mb:"2.5rem",children:(0,d.jsx)(h.Z,{display:"grid",gridAutoFlow:"row",gridGap:"2rem",children:(0,d.jsx)(p.Z,{items:[{label:"P&L",value:{loading:Boolean(q.isLoading),data:q.isSuccess&&F?"".concat((0,b.ld)((0,w.formatEther)(q.data[4]),!0)):"--"}},{label:"Liquidation Threshold",value:{loading:Boolean(C.isLoading),data:C.isSuccess&&F?"$".concat((0,w.commify)(Math.abs(C.data).toFixed(0))):"--"}},{label:"Leverage Used",value:{loading:Boolean(N.isLoading),data:N.isSuccess&&F?"".concat(parseFloat(N.data).toFixed(1),"x"):"--",customColor:N.isSuccess&&B.isSuccess&&parseFloat(N.data)>=5?"red":"lever.main"}}]})})}),(0,d.jsx)(ep,{openPositions:{query:R,sortArray:t},tradeHistory:{query:V,sortArray:n},withdrawalsAndRepayment:{query:$,sortArray:s}})]})};var ev=eg}},function(e){e.O(0,[787,828,774,888,179],function(){return e(e.s=14904)}),_N_E=e.O()}]);
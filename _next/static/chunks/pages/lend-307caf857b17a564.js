(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{20752:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/lend",function(){return t(80037)}])},47297:function(e,r,t){"use strict";var o=t(85893);t(67294);var i=t(33096),a=t(58091),n=t(46986),l=t(46558);let s=e=>{let{items:r,children:t}=e,{account:s}=(0,l.Z)();return(0,o.jsx)(i.Z,{display:"flex",flexDirection:"column",gap:"1rem",children:(0,o.jsx)(i.Z,{display:"flex",bgColor:"#181915",width:{base:"100%",lg:"min"},height:"100%",maxHeight:{base:"150px"},marginInline:"auto",borderRadius:{base:"12px",lg:"31px"},flexDirection:{base:"column",lg:"row"},alignItems:{base:"flex-start",lg:"center"},justifyContent:"space-between",padding:{base:"1.2rem 1.2rem",lg:"1.2rem 2rem"},sx:{"& > *":{whiteSpace:"nowrap"}},gap:{base:"0.5rem",lg:"5rem"},children:r&&r.map((e,r)=>{let{loading:t,data:l,customColor:d}=e.value;return(0,o.jsxs)(i.Z,{display:"inline-flex",alignItems:"center",gap:"0.5rem",children:[(0,o.jsxs)(a.Z,{variant:"banner-sub-label",children:[e.label,":"]}),t?(0,o.jsx)(n.Z,{width:"50px"}):(0,o.jsx)(a.Z,{variant:"banner-sub-desc",color:null!=d?d:void 0,children:l&&s?l:"--"})]},"".concat(r,"-").concat(e.label))})})})};r.Z=s},87303:function(e,r,t){"use strict";var o=t(85893);t(67294);var i=t(20526),a=t(58091),n=t(48641);let l=e=>{let{asset:r,value:t}=e;return(0,o.jsxs)(n.kC,{gap:"0.4rem",alignItems:"center",children:[(0,o.jsx)(i.Z,{token:r,minW:"21px",imageCustomStyle:{boxSize:"20px"},justifyContent:"center"})," ",(0,o.jsxs)(a.Z,{transform:"translateY(0.1rem)",children:[t,"%"]})]})};r.Z=l},57919:function(e,r,t){"use strict";t.d(r,{Bb:function(){return d},Fq:function(){return l},KX:function(){return a},fu:function(){return s},mW:function(){return n},pK:function(){return c},wG:function(){return u}}),t(23732);var o=t(34332),i=t(88767);let a=()=>{let{stats:e}=(0,o.Z)();return(0,i.useQuery)(["global-query"],()=>{if(!e.isSuccess)throw Error("Initializing global stats error");return e.data.global},{enabled:Boolean(void 0!==e.data)})},n=e=>{let{stats:r}=(0,o.Z)();return(0,i.useQuery)(["tokenStats",e],()=>{if(!r.isSuccess)throw Error("No stats");if(""===e)throw Error("No token");let t=r.data.assets[e];if(!t)throw Error("tokenStats not found for ".concat(e));return t},{enabled:Boolean(r.isSuccess&&""!==e)})},l=e=>{let{stats:r}=(0,o.Z)();return(0,i.useQuery)(["price-stats",JSON.stringify(r)],async()=>{if(!r.isSuccess)throw Error("No stats");if(!e)throw Error("No asset name");return r.data.assets[e].price},{enabled:Boolean(r.isSuccess&&void 0!==e)})},s=()=>{let{config:e,stats:r}=(0,o.Z)(),t=null==e?void 0:e.getAssets();return(0,i.useQuery)(["multi-price-stats",JSON.stringify(t),JSON.stringify(r.data)],async()=>{if(!t)throw Error("No config found");if(!r.isSuccess)throw Error("No stats found");let e={};for(let[o,i]of Object.entries(r.data.assets)){var a;e={...e,[null==t?void 0:null===(a=t[o])||void 0===a?void 0:a.address]:i.price}}return e},{enabled:Boolean(t&&r.isSuccess),staleTime:12e4,refetchOnWindowFocus:!1,refetchOnMount:!1})},d=()=>{let{stats:e}=(0,o.Z)();return(0,i.useQuery)(["collaterals-stats"],()=>{if(!e.isSuccess)throw Error("Initializing collateral stats error");let r={},{assets:t}=e.data;return Object.entries(t).forEach(e=>{let[t,o]=e,{collateral:i,price:a,assetConfig:n}=o;"collateral"in o&&(r={...r,[t]:{collateral:i,price:a,assetConfig:n}})}),r},{enabled:Boolean(void 0!==e.data)})},u=()=>{let{stats:e}=(0,o.Z)();return(0,i.useQuery)(["reserves-stats"],()=>{if(!e.isSuccess)throw Error("Initializing reserves stats error");let r={},{assets:t}=e.data;return Object.entries(t).forEach(e=>{let[t,o]=e,{reserve:i,price:a,assetConfig:n}=o;"reserve"in o&&(r={...r,[t]:{reserve:i,price:a,assetConfig:n}})}),r},{enabled:Boolean(void 0!==e.data)})},c=e=>{let{stats:r}=(0,o.Z)();return(0,i.useQuery)(["collateral-rewards-stats",e],async()=>{var t,o,i,a,n;if(!r.isSuccess)throw Error("collateral rewards ".concat(e," stats issue: main stats error"));let{assets:l}=r.data;return null!==(n=null!==(a=null===(t=l[e].collateral.AAVE)||void 0===t?void 0:t.rewards)&&void 0!==a?a:null===(o=l[e].collateral.Convex)||void 0===o?void 0:o.rewards)&&void 0!==n?n:null===(i=l[e].collateral.Stargate)||void 0===i?void 0:i.rewards},{enabled:Boolean(void 0!==r.data&&r.isSuccess)})}},7629:function(e,r,t){"use strict";t.d(r,{cu:function(){return d},Ct:function(){return s}});var o=t(88767),i=t(64146),a=t(56371),n=t(46558);t(23732),t(42974),t(96486);var l=t(34332);let s=e=>{let{config:r}=(0,l.Z)(),{account:t,provider:s,chainId:d}=(0,n.Z)();return(0,o.useQuery)(["use-token-balances-query",t,e],async()=>{if(!s)throw Error("No provider");if(!t)throw Error("No account");if(!r)throw Error("No config");if(!d)throw Error("Couldn't fetch chain ID");let o=r.getAsset(e),n=new i.CH(o.address,o.abi,s),l=await n.balanceOf(t);return(0,a.formatUnits)(l,o.decimals)},{staleTime:3e4,cacheTime:6e4,refetchOnMount:"always",enabled:Boolean(r&&""!==e&&t),retry:3,retryDelay:e=>1e3*e,onError(e){console.error(e)}})},d=e=>{let{multiLedger:r}=(0,l.Z)(),{account:t}=(0,n.Z)();return(0,o.useQuery)(["token-balances-new","".concat(t,"-").concat(JSON.stringify(e))],async()=>{if(!r)throw Error("Error: Multiledger not initialized");if(!t)throw Error("Error: User not logged in");if(!e)throw Error("Balance Error: no list of tokens found");let o=await r.balanceOf(e);return Object.entries(o).map(e=>{let[,r]=e;return r})},{enabled:Boolean(r&&""!==t&&!!e),retry:3,keepPreviousData:!0})}},80037:function(e,r,t){"use strict";t.r(r);var o,i,a=t(85893),n=t(67294),l=t(9008),s=t.n(l),d=t(33096),u=t(93330),c=t(53818),v=t(6937),f=t(46558),g=t(66260),m=t(57919),p=t(47297),h=t(56371),b=t(66319),y=t(34332),w=t(7629),E=t(88767),S=t(23732),x=t(11163),N=t(43382),j=t(87303);(o=i||(i={}))[o.asset=0]="asset",o[o.tvl=1]="tvl",o[o.utilizationRatio=2]="utilizationRatio",o[o.apy=3]="apy",o[o.depositedAmt=4]="depositedAmt",o[o.depositedUsd=5]="depositedUsd",o[o.balance=6]="balance";let O=()=>{var e;let[r,t]=n.useState([]),{push:o}=(0,x.useRouter)(),{isDesktopView:l}=(0,v.Z)(),{account:O,isConnected:Z}=(0,f.Z)(),{isDevMode:R}=(0,N.Z)(),{config:F,reserveBonusPool:A,multicall:C}=(0,y.Z)(),B=null==F?void 0:F.getReserves(),L=(0,m.KX)(),U=(0,m.wG)(),I=(0,b.WH)(),T=(0,m.mW)("LEVER"),k=(0,S.i1)(),z=(0,E.useQuery)(["reserves-display"],()=>B,{enabled:Boolean(F),staleTime:1/0}),Q=(0,E.useQuery)(["total-lending",O,JSON.stringify(I.data)],()=>{if(!I.isSuccess||void 0===I.data||!U.isSuccess||!B)throw Error("Total lending query error: other query dependencies not yet done");let e=0;return Object.entries(B).map(r=>{var t,o,i,a;let[n,l]=r,s=l.decimals,d=null!==(i=U.data[n].price)&&void 0!==i?i:0,u=null!==(a=null===(t=Object.entries(I.data).find(e=>{let[r]=e;return r===l.address}))||void 0===t?void 0:null===(o=t[1])||void 0===o?void 0:o.reserve)&&void 0!==a?a:(0,h.parseUnits)("0",s),c=parseFloat((0,h.formatUnits)(u,s))*d;e+=c}),e},{enabled:Boolean(I.isSuccess&&U.isSuccess&&F&&B),refetchOnWindowFocus:!1,staleTime:12e4}),_=n.useMemo(()=>F&&Object.entries(F.getReserves()).map(e=>{let[,r]=e;return r.address}),[F]),P=(0,w.cu)(null!=_?_:[""]),J=(0,E.useQuery)(["average-apr-lend",O,JSON.stringify(I)],()=>{if(!O)throw Error("Calculating average APR error: no user found");if(!L.isSuccess||!U.isSuccess||!I.isSuccess)throw Error("Calculating average APR error: stats not found");if(void 0===B)throw Error("Calculating average APR error: reserves assets from config not found");if(!Q.isSuccess)throw Error("Calculating average APR error: total lending not yet calculated");if(!F)throw Error("Calculating average APR error: No config found");let e=0,r=0,t=[],o=Q.data;for(let i of(console.log("debug",{account:O,reserves:B,reserveStats:U.data,userAssetInfoMulticall:I.data}),Object.entries(B).forEach(e=>{var r,o,i,a,n,l;let[s,d]=e,{address:u,decimals:c}=F.getAsset(s),v=null!==(n=null===(r=Object.entries(U.data).find(e=>{let[r,t]=e;return r===s}))||void 0===r?void 0:null===(o=r[1])||void 0===o?void 0:o.price)&&void 0!==n?n:0,f=null!==(l=parseFloat((0,h.formatUnits)(null===(i=Object.entries(I.data).find(e=>{let[r]=e;return r.toLowerCase()===u.toLowerCase()}))||void 0===i?void 0:null===(a=i[1])||void 0===a?void 0:a.reserve,c)))&&void 0!==l?l:0;t.push(f*v)}),Object.values(U.data))){if(0==t[r]){r+=1;continue}let{apy:a}=i.reserve,n=t[r]/o,l=a/100*n;e+=isNaN(l)?0:l,r+=1}return isNaN(100*e)?0:100*e},{enabled:Boolean(O&&void 0!==B&&L.data&&U.data&&I.data&&Q.isSuccess&&F),refetchOnMount:!1,refetchOnWindowFocus:!1}),M=(0,E.useQuery)(["total-earnings-lend",JSON.stringify(T),JSON.stringify(k),JSON.stringify(Q)],async()=>{var e;if(!F||!C)throw Error("reserve bonus pool rewards error: config not found");if(!(null===(e=T.data)||void 0===e?void 0:e.price))throw Error("lever stats not found!");if(!k.isSuccess)throw Error("subgraphDataQuery is not successful yet");if(!Q.isSuccess)throw Error("Calculating earnings: total lending not yet calculated");let{depositedValueReserve:r,withdrawnValueReserve:t}=k.data;return r||(r="0"),t||(t="0"),"$".concat(R?(0,g.RR)(Q.data+parseFloat(t)-parseFloat(r)):(0,h.commify)(parseInt(Q.data+parseFloat(t)-parseFloat(r)+"")))},{enabled:Boolean(O&&A&&F&&C&&T.isSuccess&&T.isSuccess&&k.isSuccess),retry:3,onError(e){console.warn({error:e})},refetchOnWindowFocus:!1,staleTime:12e4}),W=n.useMemo(()=>{if(!F)return[];let e=F.getReserves();return Object.entries(e).map((r,t)=>{var o,i,a,n,l,s,d,u,c,v,f,m,p,b,y,w,E,S,x,N,j,O,Z,R,F,A;let[C,B]=r;return{asset:C,tvl:{data:parseInt(String(null!==(x=null==U?void 0:null===(o=U.data)||void 0===o?void 0:null===(i=o[C])||void 0===i?void 0:null===(a=i.reserve)||void 0===a?void 0:a.tvl)&&void 0!==x?x:0)),loading:null==U?void 0:U.isLoading,error:null==U?void 0:U.isError},utilizationRatio:{data:null==U?void 0:null===(n=U.data)||void 0===n?void 0:null===(l=n[C])||void 0===l?void 0:null===(s=l.reserve)||void 0===s?void 0:null===(d=s.utilizationRatio)||void 0===d?void 0:d.toFixed(1),loading:null==U?void 0:U.isLoading,error:null==U?void 0:U.isError},apy:{data:null==U?void 0:null===(u=U.data)||void 0===u?void 0:null===(c=u[C])||void 0===c?void 0:null===(v=c.reserve)||void 0===v?void 0:null===(f=v.apy)||void 0===f?void 0:f.toFixed(2),loading:null==U?void 0:U.isLoading,error:null==U?void 0:U.isError},depositedAmt:{data:null!==(j=(0,g.RR)((0,h.formatUnits)(null!==(N=null==I?void 0:null===(m=I.data)||void 0===m?void 0:null===(p=m[B.address])||void 0===p?void 0:p.reserve)&&void 0!==N?N:(0,h.parseUnits)("0",e[C].decimals),B.decimals)))&&void 0!==j?j:"0",loading:null==I?void 0:I.isLoading,error:null==I?void 0:I.isError},depositedUsd:{data:(0,h.commify)((parseFloat(null!==(Z=(0,h.formatUnits)(null!==(O=null==I?void 0:null===(b=I.data)||void 0===b?void 0:null===(y=b[B.address])||void 0===y?void 0:y.reserve)&&void 0!==O?O:(0,h.parseUnits)("0",B.decimals),B.decimals))&&void 0!==Z?Z:"0")*(null!==(R=null==U?void 0:null===(w=U.data)||void 0===w?void 0:null===(E=w[C])||void 0===E?void 0:E.price)&&void 0!==R?R:0)).toFixed(0)),loading:null==I?void 0:I.isLoading,error:null==I?void 0:I.isError},balance:{data:null!==(A=(0,g.RR)((0,h.formatUnits)(null!==(F=null==P?void 0:null===(S=P.data)||void 0===S?void 0:S[t])&&void 0!==F?F:(0,h.parseUnits)("0",B.decimals),B.decimals)))&&void 0!==A?A:"0",loading:null==P?void 0:P.isLoading,error:null==P?void 0:P.isError}}}).sort((e,t)=>{var o,a,n,l;let s=i[r.findIndex(e=>e>0)];return"asset"===s?1===r[r.findIndex(e=>e>0)]?e.asset>t.asset?1:-1:2===r[0]?e.asset<t.asset?1:-1:0:1===r[r.findIndex(e=>e>0)]?parseFloat(null===(o=e[s])||void 0===o?void 0:o.data)<parseFloat(null===(a=t[s])||void 0===a?void 0:a.data)?1:-1:2===r[r.findIndex(e=>e>0)]?parseFloat(null===(n=e[s])||void 0===n?void 0:n.data)>parseFloat(null===(l=t[s])||void 0===l?void 0:l.data)?1:-1:0})},[F,U,I,P]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s(),{children:[(0,a.jsx)("title",{children:"Lend | LeverFi"}),(0,a.jsx)("meta",{name:"description",content:"Margin Trade with 10x Leverage using Yield Bearing Assets"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsxs)(u.Z,{pageTitle:"Lend",children:[(0,a.jsx)(d.Z,{mb:"2rem",children:(0,a.jsx)(p.Z,{items:[{label:"Total Lending",value:{loading:Boolean((Q.isLoading||Q.isFetching||Q.isIdle)&&O),data:Q.isSuccess&&O?"$".concat((0,h.commify)(null!==(e=Q.data.toFixed(0))&&void 0!==e?e:"0")):"--"}},{label:"Average APR",value:{loading:Boolean((J.isLoading||J.isIdle)&&O),data:J.isSuccess?"".concat(J.data.toLocaleString(),"%"):"--"}},{label:"Total Earnings",value:{loading:Boolean(M.isLoading||M.isFetching),data:M.isSuccess&&O?M.data:"--"}}]})}),(0,a.jsx)(d.Z,{children:(0,a.jsx)(c.Z,{query:z,headItems:[{name:"Lend"},{name:"TVL",alignment:!0},{name:"Utilization Rate",alignment:!0},{name:"APY",alignment:!0},{name:"Deposited Amt",alignment:!0},{name:"Deposited Value",alignment:!0},{name:"Wallet Balance",alignment:!0}],rows:W.map((e,r)=>{var t,i,n,l,s,d,u,c,v,f,g,m,p,b,y,w,E;return{id:"".concat(e.asset,"-").concat(r),items:[{loading:Boolean(!(null==e?void 0:e.asset)),data:null==e?void 0:e.asset,error:void 0===e.asset,isMainColumn:!0},{loading:null==e?void 0:null===(t=e.tvl)||void 0===t?void 0:t.loading,data:"$".concat((null==e?void 0:e.tvl.error)?"0":(0,h.commify)(null==e?void 0:e.tvl.data)),error:null==e?void 0:null===(i=e.tvl)||void 0===i?void 0:i.error,isNumeric:!0},{loading:null==e?void 0:null===(n=e.utilizationRatio)||void 0===n?void 0:n.loading,data:"".concat((null==e?void 0:e.utilizationRatio.error)?"0":null!==(p=null==e?void 0:e.utilizationRatio.data)&&void 0!==p?p:"0.0","%"),error:null==e?void 0:e.utilizationRatio.error,isNumeric:!0},{loading:null==e?void 0:null===(l=e.apy)||void 0===l?void 0:l.loading,data:"".concat((null==e?void 0:e.apy.error)?"0":null!==(b=null==e?void 0:e.apy.data)&&void 0!==b?b:"0.0","%"),error:null==e?void 0:null===(s=e.apy)||void 0===s?void 0:s.error,isNumeric:!0,hoverElement:(0,a.jsx)(j.Z,{asset:null==e?void 0:e.asset,value:null!==(y=null==e?void 0:null===(d=e.apy)||void 0===d?void 0:d.data)&&void 0!==y?y:"0.0"})},{loading:null==e?void 0:null===(u=e.depositedAmt)||void 0===u?void 0:u.loading,data:(null==e?void 0:e.depositedAmt.data)&&O&&null!==(w=null==e?void 0:e.depositedAmt.data)&&void 0!==w?w:"0",error:null==e?void 0:null===(c=e.depositedAmt)||void 0===c?void 0:c.error,isNumeric:!0},{loading:null==e?void 0:null===(v=e.depositedUsd)||void 0===v?void 0:v.loading,data:"$".concat((null==e?void 0:e.depositedUsd.data)&&O&&null!==(E=null==e?void 0:e.depositedUsd.data)&&void 0!==E?E:"0"),error:null==e?void 0:null===(f=e.depositedUsd)||void 0===f?void 0:f.error,isNumeric:!0},{loading:null==e?void 0:null===(g=e.balance)||void 0===g?void 0:g.loading,data:(null==e?void 0:e.balance.error)||!O?"0":null==e?void 0:e.balance.data,error:null==e?void 0:null===(m=e.balance)||void 0===m?void 0:m.error,isNumeric:!0}],pushRouter(){O&&o("lend/".concat(e.asset))}}}),acceptNotConnected:!0,placeholderCustom:"There is something wrong with loading assets, please refresh and try again.",setSortStatus:t})})]})]})};r.default=O}},function(e){e.O(0,[787,828,774,888,179],function(){return e(e.s=20752)}),_N_E=e.O()}]);